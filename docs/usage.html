
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Basic Usage &#8212; flyqma v0.3 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="External Integrations" href="integration.html" />
    <link rel="prev" title="Getting Started" href="start.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <a class="reference external image-reference" href="https://amaral.northwestern.edu/"><img alt="nulogo" class="align-right" src="_images/Northwestern_purple_RGB.png" style="width: 30%;" /></a>
<div class="section" id="basic-usage">
<h1>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h1>
<p><strong>Fly-QMA</strong> provides a wide range of functionality for measuring and analyzing mosaic imaginal discs. A brief introduction to some basic operations is provided below. For explicit API details please see the <a class="reference internal" href="documentation.html#documentation"><span class="std std-ref">code documentation</span></a>.</p>
<div class="section" id="organizing-images">
<h2>Organizing Images<a class="headerlink" href="#organizing-images" title="Permalink to this headline">¶</a></h2>
<p>We recommend first organizing your images in accordance with our recommended hierarchical <a class="reference internal" href="filestructure.html#filestructure"><span class="std std-ref">file structure</span></a>. In the examples below, <code class="docutils literal notranslate"><span class="pre">./data</span></code> would contain several subdirectories, each of which contains a single <code class="docutils literal notranslate"><span class="pre">.tif</span></code> file. Once everything is in place, get started by creating an <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> instance. This will serve as the entry-point for managing your data in Fly-QMA.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">flyqma.data</span> <span class="kn">import</span> <span class="n">experiments</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;./data&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">experiment</span> <span class="o">=</span> <span class="n">experiments</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>Lower levels of the data hierarchy may then be accessed in a top-down manner. Methods acting upon lower level instances are executed in place, meaning you won’t lose progress by iterating across instances or by coming back to a given instance at a different time.</p>
<p>To select a specific image stack:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stack_id</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">[</span><span class="n">stack_id</span><span class="p">]</span>
</pre></div>
</div>
<p>To select a specific layer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">layer_id</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">layer</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span>
</pre></div>
</div>
<p>To select a specific fluorescence channel:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">channel_id</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">channel</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">get_channel</span><span class="p">(</span><span class="n">channel_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="segmenting-images">
<h2>Segmenting Images<a class="headerlink" href="#segmenting-images" title="Permalink to this headline">¶</a></h2>
<p>See the measurement <a class="reference internal" href="modules/measurement.html#measurement-docs"><span class="std std-ref">documentation</span></a> for a list of the specific parameters needed to customize the segmentation routine to suit your data. At a minimum, users must specify the background <code class="docutils literal notranslate"><span class="pre">channel</span></code> - that is, the index of the fluorescence channel used to identify cells or nuclei, e.g. a DAPI stain.</p>
<p>To segment an image layer, measure the segment properties, and save the results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">background_channel</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">layer</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">background_channel</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">layer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Alternatively, to segment all layers within an image stack:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">background_channel</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">background_channel</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>In both cases, measurement data are generated on a layer-by-layer basis and are accessed via the <code class="docutils literal notranslate"><span class="pre">Layer.data</span></code> attribute. Specifying <code class="docutils literal notranslate"><span class="pre">save=True</span></code> or calling <code class="docutils literal notranslate"><span class="pre">layer.save()</span></code> ensures that the measurement data will remain available even after the session is terminated.</p>
</div>
<div class="section" id="analyzing-measurements">
<h2>Analyzing Measurements<a class="headerlink" href="#analyzing-measurements" title="Permalink to this headline">¶</a></h2>
<p>Measurement data are stored in a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">Pandas DataFrame</a>. Each sample (row) in the DataFrame reflects an individual cell or nuclear fluorescence measurement, whose index denotes a unique Segment ID. Columns depict a mixture of continuous and categorical features pertaining to each sample. By default, these features include:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>segment_id:</strong> The unique integer identifier assigned to the segment.</p></li>
<li><p><strong>pixel_count:</strong> The total number of pixels within the segment.</p></li>
<li><p><strong>centroid_x:</strong> The mean x-coordinate of all pixels within the segment.</p></li>
<li><p><strong>centroid_y:</strong> The mean y-coordinate of all pixels within the segment.</p></li>
<li><p><strong>chN</strong> - The mean intensity of the Nth channel across all pixels within the segment.</p></li>
<li><p><strong>chN_std</strong> - The standard deviation of the Nth channel across all pixels within the segment.</p></li>
<li><p><strong>chN_normalized</strong> - The mean intensity of the Nth channel divided by the mean intensity of the background channel.</p></li>
</ul>
</div></blockquote>
<p>Additional features are automatically appended to the DataFrame as further analyses are performed. These may include:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>chN_predicted:</strong> The estimated contribution of bleedthrough into the measured level of the Nth channel.</p></li>
<li><p><strong>chNc:</strong> The bleedthrough-corrected mean intensity of the Nth channel.</p></li>
<li><p><strong>chNc_normalized:</strong> The bleedthrough-corrected normalized mean intensity of the Nth channel.</p></li>
<li><p><strong>selected:</strong> Boolean flag indicating whether the segment falls within the user-specific ROI.</p></li>
<li><p><strong>boundary:</strong>  Boolean flag indicating whether the segment lies within a boundary between differing cell types.</p></li>
<li><p><strong>manual_label:</strong> Segment label that was manually assigned using  <a class="reference external" href="https://www.silhouette.amaral.northwestern.edu/">FlyEye Silhouette</a>.</p></li>
</ul>
</div></blockquote>
<p>Furthermore, the annotation module may be used to assign one or more labels to each segment. Users are free to specify the names of these additional features as they please.</p>
</div>
<div class="section" id="aggregating-measurements">
<h2>Aggregating Measurements<a class="headerlink" href="#aggregating-measurements" title="Permalink to this headline">¶</a></h2>
<p>To aggregate data across all layers in an image stack:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stack_data</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">aggregate_measurements</span><span class="p">()</span>
</pre></div>
</div>
<p>Similarly, to aggregate measurement data across an entire experiment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">experiment_data</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">aggregate_measurements</span><span class="p">()</span>
</pre></div>
</div>
<p>Each of these operations returns cell measurement data in the same DataFrame format discussed above. However, in order to preserve the unique identity of each measurement the index is replaced by a hierarchical index depicting the unique layer and/or stack from which each segment was derived.</p>
</div>
<div class="section" id="defining-a-roi">
<span id="gui"></span><h2>Defining a ROI<a class="headerlink" href="#defining-a-roi" title="Permalink to this headline">¶</a></h2>
<p>To import an externally generated ROI mask please refer to the <a class="reference internal" href="integration.html#roi-integration"><span class="std std-ref">integration</span></a> section.</p>
<p>Fly-QMA includes a matplot-lib based GUI for selecting a particular region of interest within an image layer. The interface consists of a grid of images in which rows correspond to layers and columns correspond to each of the available fluorescence channels. To launch the GUI for an individual image stack:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">flyqma.selection.gui</span> <span class="kn">import</span> <span class="n">GUI</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load a stack, including its image</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">load_stack</span><span class="p">(</span><span class="n">stack_ind</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># create the GUI interface (a still image)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gui</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># connect interface to user input</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gui</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</pre></div>
</div>
<p>Regions of interest are selected by drawing a selection boundary that encloses them. A selection boundary is defined by a series of sequentially-added points. Click on a layer image to add a point to that layer’s selection boundary. Points may be added to any of a layer’s fluorescence channels, and will automatically appear withing all other fluorescence channels for that layer. The most recently added point appears as a large red dot, while all other points appear as small yellow dots. Once three or more dots are present in an image layer, the current selection boundary is displayed with a yellow line. Once completed, a given layer might look like:</p>
<div class="figure align-center" id="id1">
<img alt="example gui" src="_images/example_gui.png" style="width: 675.0px; height: 450.0px;" />
<p class="caption"><span class="caption-text"><strong>Example:</strong> ROI boundaries for two layers, one of which is excluded.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>The GUI offers some basic key commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>T: remove last added point
Y: remove all points in layer
W: save ROI selection
Q: <span class="nb">exit</span> GUI
</pre></div>
</div>
<p>When a selection is saved, a boolean <em>selected</em> attribute is added to the layer’s cell measurement data indicating whether or not a given cell lies within the layer’s selection path. The <em>selected</em> attribute may then be used to filter the measurement data during subsequent analysis. The GUI also allows the user to mark entire layers for exclusion using an additional key commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>E: exclude entire layer
</pre></div>
</div>
<p>Layers marked <em>excluded</em> will be masked by a transparent overlay. When these layers are saved, the <em>selected</em> attribute is set to False for all of their constituent cell measurements.</p>
<p>A saved GUI may be reopened via the <code class="docutils literal notranslate"><span class="pre">GUI.load</span></code> method, at which point further adjustments may be made to each layer.</p>
<p>See the ROI selection <a class="reference internal" href="modules/selection.html#selection-docs"><span class="std std-ref">documentation</span></a> for additional details.</p>
</div>
<div class="section" id="correcting-bleedthrough">
<h2>Correcting Bleedthrough<a class="headerlink" href="#correcting-bleedthrough" title="Permalink to this headline">¶</a></h2>
<p>To perform bleedthrough correction:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">flyqma.bleedthrough.correction</span> <span class="kn">import</span> <span class="n">LayerCorrection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">correction</span> <span class="o">=</span> <span class="n">LayerCorrection</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">correction</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>See the bleedthrough correction <a class="reference internal" href="modules/bleedthrough.html#bleedthrough-docs"><span class="std std-ref">documentation</span></a> for additional details and a complete list of available parameters.</p>
</div>
<div class="section" id="example-projects">
<h2>Example Projects<a class="headerlink" href="#example-projects" title="Permalink to this headline">¶</a></h2>
<p>For real usage examples, please refer to the <a class="reference external" href="https://doi.org/10.1101/775783">FlyQMA manuscript</a> and <a class="reference external" href="https://doi.org/10.1101/430744">our study</a> of Pnt and Yan expression in the developing eye.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/graphics/logo.png" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=sebastianbernasek&repo=flyqma&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">INSTALLATION</a></li>
<li class="toctree-l1"><a class="reference internal" href="start.html">GETTING STARTED</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">BASIC USAGE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#organizing-images">Organizing Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#segmenting-images">Segmenting Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analyzing-measurements">Analyzing Measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aggregating-measurements">Aggregating Measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-a-roi">Defining a ROI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#correcting-bleedthrough">Correcting Bleedthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-projects">Example Projects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">INTEGRATIONS</a></li>
<li class="toctree-l1"><a class="reference internal" href="filestructure.html">FILE STRUCTURE</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">DOCUMENTATION</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">CONTACT</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="start.html" title="previous chapter">Getting Started</a></li>
      <li>Next: <a href="integration.html" title="next chapter">External Integrations</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Amaral Lab.
      
      |
      <a href="_sources/usage.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/sebastianbernasek/flyqma" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>